package com.minderv.scanners;

import com.minderv.core.model.NetworkSystem;
import com.minderv.core.model.ScanResult;
import com.minderv.scanners.impl.NmapScanner;
import com.minderv.scanners.impl.VulnerabilityDB;
import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;

import java.util.List;

public class VulnerabilityScanner {
    private static final Logger logger = LogManager.getLogger(VulnerabilityScanner.class);

    public ScanResult performScan(NetworkSystem system) {
        try {
            List<ScanResult.PortInfo> ports = NmapScanner.scanPorts(system);
            List<ScanResult.Vulnerability> vulns = VulnerabilityDB.checkVulnerabilities(ports);
            logger.info("扫描完成，发现 {} 个开放端口和 {} 个漏洞", ports.size(), vulns.size());
            return new ScanResult(ports, vulns);
        } catch (Exception e) {
            logger.error("扫描失败，返回空结果: {}", e.getMessage());
            return new ScanResult(List.of(), List.of());
        }
    }
}